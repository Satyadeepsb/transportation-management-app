// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// ============================================
// ENUMS
// ============================================

enum UserRole {
  ADMIN
  DISPATCHER
  DRIVER
  CUSTOMER
}

enum ShipmentStatus {
  PENDING
  ASSIGNED
  PICKED_UP
  IN_TRANSIT
  DELIVERED
  CANCELLED
}

enum VehicleType {
  TRUCK
  VAN
  TRAILER
  FLATBED
}

// ============================================
// MODELS
// ============================================

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Will be hashed
  firstName String
  lastName  String
  role      UserRole @default(CUSTOMER)
  phone     String?
  isActive  Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  shipmentsCreated Shipment[] @relation("ShipmentCreator")
  shipmentsAssigned Shipment[] @relation("AssignedDriver")

  @@map("users")
}

model Shipment {
  id              String          @id @default(cuid())
  trackingNumber  String          @unique @default(cuid())
  status          ShipmentStatus  @default(PENDING)

  // Shipper Information
  shipperName     String
  shipperPhone    String
  shipperEmail    String?
  shipperAddress  String
  shipperCity     String
  shipperState    String
  shipperZip      String

  // Consignee Information
  consigneeName   String
  consigneePhone  String
  consigneeEmail  String?
  consigneeAddress String
  consigneeCity   String
  consigneeState  String
  consigneeZip    String

  // Cargo Details
  cargoDescription String
  weight          Float           // in kg
  dimensions      String?         // e.g., "10x5x3 meters"
  vehicleType     VehicleType

  // Financial
  estimatedRate   Float
  actualRate      Float?
  currency        String          @default("USD")

  // Dates
  pickupDate      DateTime
  deliveryDate    DateTime?
  estimatedDelivery DateTime

  // Relationships
  createdById     String
  createdBy       User            @relation("ShipmentCreator", fields: [createdById], references: [id])

  driverId        String?
  driver          User?           @relation("AssignedDriver", fields: [driverId], references: [id])

  // Metadata
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  @@index([status])
  @@index([trackingNumber])
  @@index([createdById])
  @@index([driverId])
  @@map("shipments")
}
